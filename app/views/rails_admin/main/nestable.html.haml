:ruby
  city_id = params[:city_id]
  params = request.params.except(:authenticity_token, :action, :controller, :utf8, :bulk_export, :_pjax)

  cities = City.pluck(:title, :id)

= form_tag(nestable_path(params.except(*%w[page f city_id])), :method => :get, :class => "pjax-form form-inline") do
  .well
    %span#filters_box
      = select_tag :city_id, options_for_select(cities, city_id)


.row-fluid
  .span12#rails_admin_nestable
    .control-group
      %label{:class => 'checkbox inline' }
        %input{ :type => 'checkbox' }= t('admin.actions.nestable.live_update')
    #tree_nodes.dd{:'data-update-path' => nestable_path(model_name: @abstract_model), :'data-max-depth' => tree_max_depth}
      %ol.dd-list
        = nested_tree_nodes @tree_nodes
    .form-actions
      %button{ :type => 'submit', :class => 'btn btn-small btn-primary' }= t('admin.actions.nestable.update')

= stylesheet_link_tag    'rails_admin/rails_admin_nestable'
= javascript_include_tag 'rails_admin/jquery.nestable'
= javascript_include_tag 'rails_admin/rails_admin_nestable'

%script
  :plain
    (function(){
      $('#city_id').on( 'change', function(e){
        // wrap it as jQuery object, because pjax ignores native submit
        $(e.currentTarget.form).submit();
      });
    })();